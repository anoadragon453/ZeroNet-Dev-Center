<!DOCTYPE html>
<html lang="en">
<head>
	<title>ZeroNet Dev Center</title>
	<meta charset="utf-8">
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="keywords" content="zite,zites,important,krixano,list,category,search,filter">
	<base href="" target="_top" id="base">
	<script>base.href = document.location.href.replace("/media", "").replace("index.html", "").replace(/[&?]wrapper=False/, "").replace(/[&?]wrapper_nonce=[A-Za-z0-9]+/, "")</script>

	<link rel="stylesheet" href="css/buefy.css" />
	<link rel="stylesheet" href="css/main.css" />

	<script src="js/navToggle.js" defer></script>
</head>
<body>
	<div id="app">
		<my-hero v-bind:class="{ 'is-medium': heroIsMedium }" v-bind:title="heroTitle" v-bind:subtitle="heroSubtitle">
			<div v-html="heroContent"></div>
		</my-hero>

		<component v-bind:is="currentView" v-bind:tutorialsList="tutorialsList"></component>

		<my-footer></my-footer>
	</div>

	<script type="text/javascript" src="js/ZeroFrame.js"></script>

	<script type="text/javascript" src="js/vue.min.js"></script>
	<script type="text/javascript" src="js/router.js"></script>
	<script type="text/javascript" src="js/vue-router-link.js"></script>
	<script type="text/javascript" src="js/vueRoutes.js"></script>
	<script type="text/javascript" src="js/vueComponents.js"></script>

	<script type="text/javascript" src="js/buefy.js"></script>
	
	<script>
		/*var urlParams;
		(window.onpopstate = function () {
		    var match,
		        pl     = /\+/g,  // Regex for replacing addition symbol with a space
		        search = /([^&=]+)=?([^&]*)/g,
		        decode = function (s) { return decodeURIComponent(s.replace(pl, " ")); },
		        query  = window.location.search.substring(1);

		    urlParams = {};
		    while (match = search.exec(query))
		       urlParams[decode(match[1])] = decode(match[2]);
		})();*/

		Vue.use(Buefy);

		var app = new Vue({
			data: {
				currentView: 'route-home',
				tutorialsList: '',
				heroIsMedium: true,
				heroTitle: "ZeroNet Dev Center",
				heroSubtitle: "Tutorials, Questions, Collaboration",
				heroContent: ""
			}
		}).$mount('#app');

		class ZeroApp extends ZeroFrame {
			onOpenWebsocket () {
				this.cmd("siteInfo", {}, (site_info) => {
					if (site_info.cert_user_id)
						document.getElementById("select_user").innerText = site_info.cert_user_id
					this.site_info = site_info
				});
			}

			selectUser () {
				this.cmd("certSelect", {accepted_domains: ["zeroid.bit", "kaffie.bit", "cryptoid.bit"]})
				return false
			}

			onRequest (cmd, message) {
				if (cmd == "setSiteInfo") {
					this.site_info = message.params  // Save site info data to allow access it later
					if (message.params.cert_user_id){
						document.getElementById("select_user").innerHTML = message.params.cert_user_id
					} else if (!message.params.cert_user_id) {
						document.getElementById("select_user").innerHTML = "Select user"
					} else if (message.params.event && message.params.event[0] == "file_done") {
						//this.loadZiteIndicator();
					}
				}

				Router.listenForBack(cmd, message);
			}
		}

		zeroframe = new ZeroApp()

		function is_click() {
			app.heroIsMedium = false;
		}
	</script>

	<script>
		Router.config({ mode: 'history' });

		Router.add("about", function () {
			app.heroIsMedium = false;
			app.heroTitle = "About";
			app.heroSubtitle = "";
			app.heroContent = "";
		}).add("tutorials", function() {
			app.heroIsMedium = false;
			app.heroTitle = "Tutorials";
			app.heroSubtitle = "";
			app.heroContent = "";
		}).add("products/:pid/edit/:eid", function(params) {
			console.log('products', params.pid, params.eid);
		}).add(function() {
			app.heroIsMedium = true;
			app.heroTitle = "ZeroNet Dev Center";
			app.heroSubtitle = "Tutorials, Questions, Collaboration";
			app.heroContent = '<a href="tutorials/?t=the_basics" class="button is-info">The Basics</a>\
			<a href="tutorials/" style="margin-top: 10px; margin-left: 10px;">All Tutorials</a>';

			zeroframe.cmd('dbQuery', ['SELECT * FROM tutorials'], (tutorials) => {
				for (var i in tutorials) {
					app.tutorialsList += "<a href='tutorials/?t=" + tutorials[i].slug + "'>" + tutorials[i].title + "</a><br>";
				}
				//this.cmd('wrapperPushState', [{}, '', '']);
				app.tutorialsList += "Database Basics (Coming Soon)";
			});
		}).all(function(currentRoute) {
			app.currentView = 'route-' + currentRoute.replace(/\//, '_');
			if (currentRoute == '') {
				app.currentView = 'route-home';
			}
		});
		Router.init();
	</script>
</body>
</html>